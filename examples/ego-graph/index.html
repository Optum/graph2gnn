
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.0, mkdocs-material-8.5.6">
    
    
      
        <title>Graph-Level - graph2gnn</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Arial:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Arial";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../styles/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="blue-grey">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#graph-classification" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      


<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">

    <!-- 
      <a href="/" target="_blank" title="graph2gnn" class="md-header__button" aria-label="graph2gnn">
        <img src="../img/logo.svg" style="width: 200px;">
      </a>
   -->
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            graph2gnn
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Graph-Level
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="blue-grey"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="blue-grey"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Optum/graph2gnn" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    graph2gnn
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      graph2gnn
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../examples/" class="md-tabs__link md-tabs__link--active">
        Examples
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../about/about/" class="md-tabs__link">
        About
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="graph2gnn" class="md-nav__button md-logo" aria-label="graph2gnn" data-md-component="logo">
      
  <img src="../../img/g2gnn.png" alt="logo">

    </a>
    graph2gnn
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Optum/graph2gnn" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    graph2gnn
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        graph2gnn
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        Examples
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../node-level/" class="md-nav__link">
        Node-Level
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Graph-Level
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Graph-Level
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-the-data" class="md-nav__link">
    Load the Data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-query" class="md-nav__link">
    The Query
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#write-a-subclass-for-tiger2gnn" class="md-nav__link">
    Write a subclass for Tiger2GNN
  </a>
  
    <nav class="md-nav" aria-label="Write a subclass for Tiger2GNN">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#subgraph-query-method" class="md-nav__link">
    Subgraph Query Method
  </a>
  
    <nav class="md-nav" aria-label="Subgraph Query Method">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note" class="md-nav__link">
    Note
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploratory-data-analysis" class="md-nav__link">
    Exploratory Data Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_vertex_vectors" class="md-nav__link">
    compute_vertex_vectors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assemblesplit" class="md-nav__link">
    assemble/split
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dgl" class="md-nav__link">
    DGL
  </a>
  
    <nav class="md-nav" aria-label="DGL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dgl-dataset" class="md-nav__link">
    DGL Dataset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-building-and-training" class="md-nav__link">
    Model building and training
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          About
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../about/about/" class="md-nav__link">
        About
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-the-data" class="md-nav__link">
    Load the Data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-query" class="md-nav__link">
    The Query
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#write-a-subclass-for-tiger2gnn" class="md-nav__link">
    Write a subclass for Tiger2GNN
  </a>
  
    <nav class="md-nav" aria-label="Write a subclass for Tiger2GNN">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#subgraph-query-method" class="md-nav__link">
    Subgraph Query Method
  </a>
  
    <nav class="md-nav" aria-label="Subgraph Query Method">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note" class="md-nav__link">
    Note
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploratory-data-analysis" class="md-nav__link">
    Exploratory Data Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_vertex_vectors" class="md-nav__link">
    compute_vertex_vectors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assemblesplit" class="md-nav__link">
    assemble/split
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dgl" class="md-nav__link">
    DGL
  </a>
  
    <nav class="md-nav" aria-label="DGL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dgl-dataset" class="md-nav__link">
    DGL Dataset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-building-and-training" class="md-nav__link">
    Model building and training
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/Optum/graph2gnn/edit/master/docs/examples/ego-graph.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="graph-classification">Graph Classification<a class="headerlink" href="#graph-classification" title="Permanent link">&para;</a></h1>
<p>Graph-level classification on the <a href="http://snap.stanford.edu/data/twitch_ego_nets.html" target="_blank">Twitch Ego Nets</a> dataset from a TigerGraph DB using g2gnn and DGL.</p>
<!-- ##[Check it out](https://github.com/Optum/graph2gnn/tree/main/examples/graph-level/ego/twitch) -->

<h3 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h3>
<p>Another option for learning graph structures is at the graph or subgraph level. While node classification takes the region around a node to classify that node, graph-level classification aims to classify the region itself (in the case of subgraph classification), or the graph as a whole (e.g., molecule classification).</p>
<p>The example code is <a href="https://github.com/Optum/graph2gnn/tree/main/examples/graph-level/ego/twitch">HERE</a>. First, <a href="../..#installation">install g2gnn</a> and navigate to the graph-level/twitch directory under examples. Details are below.</p>
<h3 id="load-the-data">Load the Data<a class="headerlink" href="#load-the-data" title="Permanent link">&para;</a></h3>
<p>Once you have stood up your tigergraph instance[^1], you can generate the files to load the data to graph by running [prepare_graph.ipynb]. When it's done, copy the files to your env. You should be able to run [setup.gsql] in the gsql shell to generate the schema, TwitchEgos, load the data and finally install the query.</p>
<h3 id="the-query">The Query<a class="headerlink" href="#the-query" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">QUERY</span><span class="w"> </span><span class="n">TwitchEgosData</span><span class="o">(</span><span class="k">INT</span><span class="w"> </span><span class="n">current_partition</span><span class="o">=</span><span class="m">0</span><span class="o">,</span><span class="w"> </span><span class="k">INT</span><span class="w"> </span><span class="n">total_partitions</span><span class="o">=</span><span class="m">10</span><span class="o">)</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="k">GRAPH</span><span class="w"> </span><span class="n">TwitchEgos</span><span class="w"> </span><span class="k">SYNTAX</span><span class="w"> </span><span class="n">V2</span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">  </span><span class="k">TYPEDEF</span><span class="w"> </span><span class="k">TUPLE</span><span class="w"> </span><span class="p">&lt;</span><span class="k">INT</span><span class="w"> </span><span class="n">from_id</span><span class="o">,</span><span class="w"> </span><span class="k">INT</span><span class="w"> </span><span class="n">to_id</span><span class="p">&gt;</span><span class="w"> </span><span class="n">Edges</span><span class="o">;</span><span class="w"> </span><span class="c1"># GNN train type</span><span class="w"></span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">  </span><span class="k">TYPEDEF</span><span class="w"> </span><span class="k">TUPLE</span><span class="w"> </span><span class="p">&lt;</span><span class="k">INT</span><span class="w"> </span><span class="n">id</span><span class="o">,</span><span class="w"> </span><span class="k">STRING</span><span class="w"> </span><span class="n">v_type</span><span class="p">&gt;</span><span class="w"> </span><span class="n">Vert</span><span class="o">;</span><span class="w"> </span><span class="c1"># GNN train type</span><span class="w"></span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">  </span><span class="c1"># Accumulators for tracking edges and involved vertices </span><span class="w"></span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">  </span><span class="nb">MaxAccum</span><span class="p">&lt;</span><span class="k">INT</span><span class="p">&gt;</span><span class="w"> </span><span class="nv">@id</span><span class="o">,</span><span class="w"> </span><span class="nv">@deg</span><span class="o">;</span><span class="w"></span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">  </span><span class="nb">MapAccum</span><span class="p">&lt;</span><span class="k">INT</span><span class="o">,</span><span class="w"> </span><span class="nb">SetAccum</span><span class="p">&lt;</span><span class="n">Edges</span><span class="p">&gt;&gt;</span><span class="w"> </span><span class="nv">@@edges</span><span class="o">;</span><span class="w"></span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">  </span><span class="nb">MapAccum</span><span class="p">&lt;</span><span class="k">INT</span><span class="o">,</span><span class="w"> </span><span class="nb">SetAccum</span><span class="p">&lt;</span><span class="n">Vert</span><span class="p">&gt;&gt;</span><span class="w"> </span><span class="nv">@@graph</span><span class="o">;</span><span class="w"></span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">  </span><span class="n">Users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">User</span><span class="p">.*}</span><span class="o">;</span><span class="w"></span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">  </span><span class="n">Users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Users</span><span class="o">:</span><span class="n">s</span><span class="w"> </span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">          </span><span class="k">WHERE</span><span class="w"> </span><span class="n">vertex_to_int</span><span class="o">(</span><span class="n">s</span><span class="o">)</span><span class="w"> </span><span class="err">%</span><span class="w"> </span><span class="n">total_partitions</span><span class="w"> </span><span class="o">== </span><span class="n">current_partition</span><span class="w"></span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">          </span><span class="k">ACCUM</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="nv">@id</span><span class="w"> </span><span class="o">+= </span><span class="n">getvid</span><span class="o">(</span><span class="n">s</span><span class="o">),</span><span class="w"></span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">                </span><span class="nv">@@graph</span><span class="w"> </span><span class="o">+= (</span><span class="n">getvid</span><span class="o">(</span><span class="n">s</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Vert</span><span class="o">(</span><span class="n">getvid</span><span class="o">(</span><span class="n">s</span><span class="o">),</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">type</span><span class="o">)),</span><span class="w"></span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">                </span><span class="n">s</span><span class="p">.</span><span class="nv">@deg</span><span class="w"> </span><span class="o">+= </span><span class="n">s</span><span class="p">.</span><span class="n">outdegree</span><span class="o">();</span><span class="w"></span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">  </span><span class="c1"># max 2-hop graph (this should be enough to encompas all subgraphs anyway)</span><span class="w"></span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">  </span><span class="n">Friends1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Users</span><span class="o">:</span><span class="n">s</span><span class="w"> </span><span class="o">-(</span><span class="n">FRIENDSHIP</span><span class="o">:</span><span class="n">e</span><span class="o">)-</span><span class="w"> </span><span class="n">Friend</span><span class="o">:</span><span class="n">f</span><span class="w"></span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">             </span><span class="k">WHERE</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">label</span><span class="w"> </span><span class="p">&gt;</span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">             </span><span class="k">ACCUM</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="nv">@id</span><span class="w"> </span><span class="o">+= </span><span class="n">getvid</span><span class="o">(</span><span class="n">f</span><span class="o">),</span><span class="w"></span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">                   </span><span class="nv">@@edges</span><span class="w"> </span><span class="o">+= (</span><span class="n">getvid</span><span class="o">(</span><span class="n">s</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Edges</span><span class="o">(</span><span class="n">getvid</span><span class="o">(</span><span class="n">s</span><span class="o">),</span><span class="w"> </span><span class="n">getvid</span><span class="o">(</span><span class="n">f</span><span class="o">))),</span><span class="w"></span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">                   </span><span class="nv">@@graph</span><span class="w"> </span><span class="o">+= (</span><span class="n">getvid</span><span class="o">(</span><span class="n">s</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Vert</span><span class="o">(</span><span class="n">getvid</span><span class="o">(</span><span class="n">f</span><span class="o">),</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">type</span><span class="o">)),</span><span class="w"></span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="w">                   </span><span class="n">f</span><span class="p">.</span><span class="nv">@deg</span><span class="w"> </span><span class="o">+= </span><span class="n">f</span><span class="p">.</span><span class="n">outdegree</span><span class="o">();</span><span class="w"></span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="w">  </span><span class="n">Friends2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">tgt</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Users</span><span class="o">:</span><span class="n">s</span><span class="w"> </span><span class="o">-(</span><span class="n">FRIENDSHIP</span><span class="o">:</span><span class="n">e</span><span class="o">)- </span><span class="p">_</span><span class="o">:</span><span class="n">f</span><span class="w"> </span><span class="o">-(</span><span class="n">FRIENDSHIP</span><span class="o">:</span><span class="n">e</span><span class="o">)-</span><span class="w"> </span><span class="n">Friend</span><span class="o">:</span><span class="n">tgt</span><span class="w"></span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">             </span><span class="k">WHERE</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">label</span><span class="w"> </span><span class="p">&gt;</span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="w">             </span><span class="k">ACCUM</span><span class="w"> </span><span class="n">tgt</span><span class="p">.</span><span class="nv">@id</span><span class="w"> </span><span class="o">+= </span><span class="n">getvid</span><span class="o">(</span><span class="n">tgt</span><span class="o">),</span><span class="w"></span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">                   </span><span class="nv">@@edges</span><span class="w"> </span><span class="o">+= (</span><span class="n">getvid</span><span class="o">(</span><span class="n">s</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Edges</span><span class="o">(</span><span class="n">getvid</span><span class="o">(</span><span class="n">f</span><span class="o">),</span><span class="w"> </span><span class="n">getvid</span><span class="o">(</span><span class="n">tgt</span><span class="o">))),</span><span class="w"></span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">                   </span><span class="nv">@@graph</span><span class="w"> </span><span class="o">+= (</span><span class="n">getvid</span><span class="o">(</span><span class="n">s</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Vert</span><span class="o">(</span><span class="n">getvid</span><span class="o">(</span><span class="n">tgt</span><span class="o">),</span><span class="w"> </span><span class="n">tgt</span><span class="p">.</span><span class="n">type</span><span class="o">)),</span><span class="w"></span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">                   </span><span class="n">f</span><span class="p">.</span><span class="nv">@deg</span><span class="w"> </span><span class="o">+= </span><span class="n">f</span><span class="p">.</span><span class="n">outdegree</span><span class="o">(),</span><span class="w"></span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">                   </span><span class="n">tgt</span><span class="p">.</span><span class="nv">@deg</span><span class="w"> </span><span class="o">+= </span><span class="n">tgt</span><span class="p">.</span><span class="n">outdegree</span><span class="o">();</span><span class="w"></span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">  </span><span class="n">Friends</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Friends1</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="n">Friends2</span><span class="o">;</span><span class="w"></span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="w">  </span><span class="k">PRINT</span><span class="w"> </span><span class="nv">@@edges</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">_</span><span class="n">edges</span><span class="o">;</span><span class="w"> </span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="w">  </span><span class="k">PRINT</span><span class="w"> </span><span class="nv">@@graph</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">_</span><span class="k">graph</span><span class="o">;</span><span class="w"></span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="w">  </span><span class="k">PRINT</span><span class="w"> </span><span class="n">Users</span><span class="o">;</span><span class="w"></span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">  </span><span class="k">PRINT</span><span class="w"> </span><span class="n">Friends</span><span class="o">;</span><span class="w"></span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="p">}</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>Lines 2 and 3 define types that graph2gnn will use to extract the graph structures from the query's response. These types allow for the minimal amount of data to be sent in the response. If you there are edge features in your dataset, add them as attributes to th <code>Edges</code> type like this: <code>TYPEDEF TUPLE &lt;INT from_id, INT to_id, INT feat_name1, String INT feat_name2...&gt; Edges;</code></p>
<p>Lines 6 through 8 instantiate ID, feature (<code>@deg</code>) and global map accumulators to keep track of the adjacency information and graph membership. <code>@@edges</code> is a key-value store that holds the adjacency information of each subgraph where the ID of the subgraph's ego is the key and the values are the edges of that subgraph. <code>@@graph</code> has the same keys as edges, but its values simply store which vertices belong to which graph. This allows you to more quickly select features that go into the individual graphs when you're assembling the dataset.</p>
<p>Lines 10 through 27 are the main body of the query. The actions to take note of are additions to the <code>@@edges</code> and <code>@@graph</code> map accums. Same as in the node-level query, you have access to all of the features of GSQL here to help you refine the subgraphs that you want.</p>
<p>NOTE: It's critical that the edges accumulator is printed as <code>_edges</code> and the graph accumulator as <code>_graph</code> (lines 33, 34). Graph2GNN looks for <code>_edges</code> and <code>_graph</code> to reconstruct the adjecency information.</p>
<p>In the case of subgraph classification, it's not uncommon that a vertex is a part of multiple graphs.</p>
<h2 id="write-a-subclass-for-tiger2gnn">Write a subclass for Tiger2GNN<a class="headerlink" href="#write-a-subclass-for-tiger2gnn" title="Permanent link">&para;</a></h2>
<p>At this point, you should have a the TwitchEgos graph loaded to your TG instance. Now we'll begin to walk through the python code in <a href="https://github.com/Optum/graph2gnn/tree/main/examples/graph-level/ego/twitch/graph-classification.ipynb">graph-classification.ipynb</a> to get the data and train a GCN. Feel free to write to write your own code and use the docs and example code as a guide.</p>
<p>The first cell initializes Twitch2GNN, which is subclassed from Tiger2GNN. Subclassing is a convenient way to organize all the code around gathering data from the graph and making it ready for training.</p>
<p>When you initialize the object from your subclass (or just the Tiger2GNN class), you must pass in the host, graph_name, the query you will call and any credential info (e.g. the restpp token).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">class</span> <span class="nc">Twitch2GNN</span><span class="p">(</span><span class="n">Tiger2GNN</span><span class="p">):</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>        <span class="o">...</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="k">def</span> <span class="nf">compute_vertex_vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>        <span class="o">...</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="n">tg</span> <span class="o">=</span> <span class="n">Twitch2GNN</span><span class="p">(</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>    <span class="n">host</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>    <span class="n">graph_name</span><span class="o">=</span><span class="s2">&quot;Cora&quot;</span><span class="p">,</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>    <span class="n">query</span><span class="o">=</span><span class="s2">&quot;CoraData&quot;</span><span class="p">,</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>    <span class="n">token</span><span class="o">=</span><span class="n">tkn</span><span class="p">,</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="p">)</span>
</code></pre></div>
<h3 id="subgraph-query-method">Subgraph Query Method<a class="headerlink" href="#subgraph-query-method" title="Permanent link">&para;</a></h3>
<p>The call_subgraph_query calls a query written in the form described above. If there are any parameters, such as partitioning values, pass them in to the params argument. Call the method to get the data.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">tg</span><span class="o">.</span><span class="n">call_subgraph_query</span><span class="p">()</span>
</code></pre></div>
<h4 id="note">Note<a class="headerlink" href="#note" title="Permanent link">&para;</a></h4>
<p>At this point, g2gnn has done its job. You can use the resulting data in any way you wish! What follows is a guide to build the output from call_singlegraph_query into a GCN.</p>
<h3 id="exploratory-data-analysis">Exploratory Data Analysis<a class="headerlink" href="#exploratory-data-analysis" title="Permanent link">&para;</a></h3>
<p>Once the data has been stored locally, if the data is still raw, now is when you would do any necessary exploratory data analysis (EDA), feature selection, etc. No EDA is needed for this example, since the graph stores the features directly. When the method is finished, the tg response directory will contain the following structure.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>project-root
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>├── tgresponse/
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>│   ├── subgraph/
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>│   │   ├── &lt;graph ID&gt;_edges.csv    (adjacency info... will become a model input)
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>│   │   └── &lt;graph ID&gt;_graph.csv    (membership info... use to help select vertex vectors for the graph when assembling the datset)
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>│   ├── parts/
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>│   │   └── partition_0.json         (whole query responses, saved by partition)
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>│   ├── Friends.json                 (vertex set response... create vectors from these files)
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>│   ├── Users.json
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>└── graph-classification.ipynb
</code></pre></div>
<h3 id="compute_vertex_vectors">compute_vertex_vectors<a class="headerlink" href="#compute_vertex_vectors" title="Permanent link">&para;</a></h3>
<p>The first of the custom methods in the Twitch2GNN subclass is used to compute, or in this case organize, the vectors that will represent each vertex.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">tg</span><span class="o">.</span><span class="n">compute_vertex_vectors</span><span class="p">()</span>
</code></pre></div>
<h3 id="assemblesplit">assemble/split<a class="headerlink" href="#assemblesplit" title="Permanent link">&para;</a></h3>
<p>The next cell shows the label split and some other dataset metrics. Here's a good place to have a sanity check.</p>
<p>Unlike the node-level example, the assembly code is moved into a separate script in order to take advantage of concurrent processing.</p>
<p>When the method is finished, the tg response directory will contain the following structure.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>project-root
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>├── tgresponse/
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>│   ├── subgraph/
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>│   │   ├── &lt;graph ID&gt;_edges.csv       (adjacency info... will become a model input)
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>│   │   ├── &lt;graph ID&gt;_graph.csv       (membership info... use to help select vertex vectors for the graph when assembling the datset)
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>│   │   └── &lt;graph ID&gt;_vectors.csv  ***(vectorized vertices... will become a model input)
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>│   ├── parts/
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>│   │   └── partition_0.json           
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>│   ├── Friends.json                   
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>│   ├── Friends.csv                   
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>│   ├── Users.json
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>│   ├── Users.csv
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>└── graph-classification.ipynb
</code></pre></div>
<h2 id="dgl">DGL<a class="headerlink" href="#dgl" title="Permanent link">&para;</a></h2>
<p>Now the graph data is ready. From this point on, feel free to continue in whichever graph-ML library is your preference. this example continues in pytorch-flavored <a href="https://www.dgl.ai">DGL</a>.</p>
<h3 id="dgl-dataset">DGL Dataset<a class="headerlink" href="#dgl-dataset" title="Permanent link">&para;</a></h3>
<p>Following the dgl doc's for <a href="https://docs.dgl.ai/tutorials/blitz/6_load_data.html#creating-a-dataset-for-graph-classification-from-csv">making your own dataset</a>, we subclass DGLDataset class and override the <code>__getitem__</code>, <code>__len__</code>, and <code>process</code> methods. When constructing the graphs, keep in mind that node IDs have to be 0-indexed. Any node IDs used previously need to be tranlated into the ID-space for DGL. This is handled on lines 38-47 in the dataset instantiating cell.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">class</span> <span class="nc">TwitchDataset</span><span class="p">(</span><span class="n">DGLDataset</span><span class="p">):</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_nodes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphs</span><span class="p">)</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>        <span class="c1"># lines 38-47 have the ID transfer code</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>        <span class="o">...</span>
</code></pre></div>
<h3 id="model-building-and-training">Model building and training<a class="headerlink" href="#model-building-and-training" title="Permanent link">&para;</a></h3>
<p>Again, following <a href="https://docs.dgl.ai/tutorials/blitz/5_graph_classification.html">DGL's docs</a>, the model is constructed and trained in the following cells.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">class</span> <span class="nc">TwitchModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">):</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">dglnn</span><span class="o">.</span><span class="n">GraphConv</span><span class="p">(</span><span class="n">in_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">)</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">dglnn</span><span class="o">.</span><span class="n">GraphConv</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">)</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span><span class="n">dgl</span><span class="o">.</span><span class="n">DGLGraph</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>        <span class="n">h</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>        <span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>        <span class="k">return</span> <span class="n">dgl</span><span class="o">.</span><span class="n">mean_nodes</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">)</span>
</code></pre></div>
<h3 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h3>
<p>Congrats on getting to the end! If you run into any issues or questions, please reach out on <a href="https://github.com/Optum/graph2gnn/issues">Github</a>.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../node-level/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Node-Level" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Node-Level
            </div>
          </div>
        </a>
      
      
        
        <a href="../../about/about/" class="md-footer__link md-footer__link--next" aria-label="Next: About" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              About
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 Optum
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tabs"], "search": "../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.078830c0.min.js"></script>
      
    
  </body>
</html>